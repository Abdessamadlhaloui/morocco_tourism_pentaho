<?xml version="1.0" ?>
<transformation>
  <info>
    <name>06_capacite_hoteliere</name>
    <description>Transformation for loading 06_capacite_hoteliere.csv into PostgreSQL</description>
    <extended_description/>
    <trans_version/>
    <trans_type>Normal</trans_type>
    <directory>/</directory>
    <parameters/>
    <log>
      <trans-log-table>
        <connection/>
        <schema/>
        <table/>
        <size_limit_lines/>
        <interval/>
        <timeout_days/>
        <field/>
      </trans-log-table>
    </log>
  </info>
  <connection>
    <name>morocco_tourism</name>
    <server>localhost</server>
    <type>POSTGRESQL</type>
    <access>Native</access>
    <database>morocco_tourism</database>
    <port>5432</port>
    <username>postgres</username>
    <password>your_password_here</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <step>
    <name>Lire_capacite_hoteliere</name>
    <type>TextFileInput</type>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
    </partitioning>
    <cluster_schema/>
    <remotesteps/>
    <attributes/>
    <GUI>
      <xloc>100</xloc>
      <yloc>100</yloc>
      <draw>Y</draw>
    </GUI>
    <separator>,</separator>
    <enclosure>&quot;</enclosure>
    <encl_breaks>N</encl_breaks>
    <header>Y</header>
    <nr_headerlines>1</nr_headerlines>
    <footer>N</footer>
    <nr_footlines>0</nr_footlines>
    <line_wrapped>N</line_wrapped>
    <nr_wraps>0</nr_wraps>
    <layout_paged>N</layout_paged>
    <nr_lines_per_page>0</nr_lines_per_page>
    <compression>None</compression>
    <noempty>N</noempty>
    <include>N</include>
    <include_field/>
    <rownum>N</rownum>
    <rownum_field/>
    <format>mixed</format>
    <encoding>UTF-8</encoding>
    <length/>
    <limit>0</limit>
    <error_ignored>N</error_ignored>
    <skip_bad_files>N</skip_bad_files>
    <file_error_field/>
    <file_error_message_field/>
    <error_line_skipped>N</error_line_skipped>
    <error_count_field/>
    <error_fields_field/>
    <error_text_field/>
    <warning_files_destination_directory/>
    <warning_files_extension>warning</warning_files_extension>
    <error_files_destination_directory/>
    <error_files_extension>error</error_files_extension>
    <line_number_files_destination_directory/>
    <line_number_files_extension>line</line_number_files_extension>
    <date_format_lenient>Y</date_format_lenient>
    <date_format_locale>en_US</date_format_locale>
    <file>
      <name>data/raw/06_capacite_hoteliere.csv</name>
      <filemask/>
      <exclude_filemask/>
      <file_required>N</file_required>
      <include_subfolders>N</include_subfolders>
    </file>
    <fields>
      <field>
        <name>Categorie</name>
        <type>String</type>
        <format/>
        <length>-1</length>
        <precision>0</precision>
        <currency/>
        <decimal/>
        <group/>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>Annee_2019_Units</name>
        <type>String</type>
        <format/>
        <length>-1</length>
        <precision>0</precision>
        <currency/>
        <decimal/>
        <group/>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>Annee_2019_Chambres</name>
        <type>String</type>
        <format/>
        <length>-1</length>
        <precision>0</precision>
        <currency/>
        <decimal/>
        <group/>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>Annee_2019_Lits</name>
        <type>String</type>
        <format/>
        <length>-1</length>
        <precision>0</precision>
        <currency/>
        <decimal/>
        <group/>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>Annee_2021_Units</name>
        <type>String</type>
        <format/>
        <length>-1</length>
        <precision>0</precision>
        <currency/>
        <decimal/>
        <group/>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>Annee_2021_Chambres</name>
        <type>String</type>
        <format/>
        <length>-1</length>
        <precision>0</precision>
        <currency/>
        <decimal/>
        <group/>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>Annee_2021_Lits</name>
        <type>String</type>
        <format/>
        <length>-1</length>
        <precision>0</precision>
        <currency/>
        <decimal/>
        <group/>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>Annee_2022_Units</name>
        <type>String</type>
        <format/>
        <length>-1</length>
        <precision>0</precision>
        <currency/>
        <decimal/>
        <group/>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>Annee_2022_Chambres</name>
        <type>String</type>
        <format/>
        <length>-1</length>
        <precision>0</precision>
        <currency/>
        <decimal/>
        <group/>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>Annee_2022_Lits</name>
        <type>String</type>
        <format/>
        <length>-1</length>
        <precision>0</precision>
        <currency/>
        <decimal/>
        <group/>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
    </fields>
  </step>
  <step>
    <name>Selection_2019</name>
    <type>SelectValues</type>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
    </partitioning>
    <cluster_schema/>
    <remotesteps/>
    <attributes/>
    <GUI>
      <xloc>300</xloc>
      <yloc>100</yloc>
      <draw>Y</draw>
    </GUI>
    <fields>
      <field>
        <name>Categorie</name>
        <rename>categorie</rename>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Annee_2019_Units</name>
        <rename>units</rename>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Annee_2019_Chambres</name>
        <rename>chambres</rename>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Annee_2019_Lits</name>
        <rename>lits</rename>
        <length>-1</length>
        <precision>-1</precision>
      </field>
    </fields>
  </step>
  <step>
    <name>Ajout_annee_2019</name>
    <type>Calculator</type>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
    </partitioning>
    <cluster_schema/>
    <remotesteps/>
    <attributes/>
    <GUI>
      <xloc>500</xloc>
      <yloc>100</yloc>
      <draw>Y</draw>
    </GUI>
    <calculations>
      <calculation>
        <calculation_name>annee</calculation_name>
        <calculation_formula/>
        <calculation_type>CONSTANT</calculation_type>
        <calculation_value>2019</calculation_value>
        <calculation_value_type>Integer</calculation_value_type>
        <calculation_length>4</calculation_length>
        <calculation_precision>0</calculation_precision>
        <calculation_format/>
        <calculation_currency/>
        <calculation_decimal/>
        <calculation_group/>
        <calculation_remove>N</calculation_remove>
      </calculation>
    </calculations>
  </step>
  <step>
    <name>Selection_2021</name>
    <type>SelectValues</type>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
    </partitioning>
    <cluster_schema/>
    <remotesteps/>
    <attributes/>
    <GUI>
      <xloc>700</xloc>
      <yloc>300</yloc>
      <draw>Y</draw>
    </GUI>
    <fields>
      <field>
        <name>Categorie</name>
        <rename>categorie</rename>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Annee_2021_Units</name>
        <rename>units</rename>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Annee_2021_Chambres</name>
        <rename>chambres</rename>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Annee_2021_Lits</name>
        <rename>lits</rename>
        <length>-1</length>
        <precision>-1</precision>
      </field>
    </fields>
  </step>
  <step>
    <name>Ajout_annee_2021</name>
    <type>Calculator</type>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
    </partitioning>
    <cluster_schema/>
    <remotesteps/>
    <attributes/>
    <GUI>
      <xloc>700</xloc>
      <yloc>300</yloc>
      <draw>Y</draw>
    </GUI>
    <calculations>
      <calculation>
        <calculation_name>annee</calculation_name>
        <calculation_formula/>
        <calculation_type>CONSTANT</calculation_type>
        <calculation_value>2021</calculation_value>
        <calculation_value_type>Integer</calculation_value_type>
        <calculation_length>4</calculation_length>
        <calculation_precision>0</calculation_precision>
        <calculation_format/>
        <calculation_currency/>
        <calculation_decimal/>
        <calculation_group/>
        <calculation_remove>N</calculation_remove>
      </calculation>
    </calculations>
  </step>
  <step>
    <name>Selection_2022</name>
    <type>SelectValues</type>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
    </partitioning>
    <cluster_schema/>
    <remotesteps/>
    <attributes/>
    <GUI>
      <xloc>700</xloc>
      <yloc>500</yloc>
      <draw>Y</draw>
    </GUI>
    <fields>
      <field>
        <name>Categorie</name>
        <rename>categorie</rename>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Annee_2022_Units</name>
        <rename>units</rename>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Annee_2022_Chambres</name>
        <rename>chambres</rename>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Annee_2022_Lits</name>
        <rename>lits</rename>
        <length>-1</length>
        <precision>-1</precision>
      </field>
    </fields>
  </step>
  <step>
    <name>Ajout_annee_2022</name>
    <type>Calculator</type>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
    </partitioning>
    <cluster_schema/>
    <remotesteps/>
    <attributes/>
    <GUI>
      <xloc>700</xloc>
      <yloc>500</yloc>
      <draw>Y</draw>
    </GUI>
    <calculations>
      <calculation>
        <calculation_name>annee</calculation_name>
        <calculation_formula/>
        <calculation_type>CONSTANT</calculation_type>
        <calculation_value>2022</calculation_value>
        <calculation_value_type>Integer</calculation_value_type>
        <calculation_length>4</calculation_length>
        <calculation_precision>0</calculation_precision>
        <calculation_format/>
        <calculation_currency/>
        <calculation_decimal/>
        <calculation_group/>
        <calculation_remove>N</calculation_remove>
      </calculation>
    </calculations>
  </step>
  <step>
    <name>Union_annees</name>
    <type>Append</type>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
    </partitioning>
    <cluster_schema/>
    <remotesteps/>
    <attributes/>
    <GUI>
      <xloc>700</xloc>
      <yloc>100</yloc>
      <draw>Y</draw>
    </GUI>
    <hold_on_error>N</hold_on_error>
  </step>
  <step>
    <name>Convertir_types</name>
    <type>SelectValues</type>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
    </partitioning>
    <cluster_schema/>
    <remotesteps/>
    <attributes/>
    <GUI>
      <xloc>900</xloc>
      <yloc>100</yloc>
      <draw>Y</draw>
    </GUI>
    <fields>
      <field>
        <name>annee</name>
        <rename/>
        <type>Integer</type>
        <format>####</format>
        <length>4</length>
        <precision>0</precision>
      </field>
      <field>
        <name>units</name>
        <rename/>
        <type>Integer</type>
        <format>########</format>
        <length>10</length>
        <precision>0</precision>
      </field>
      <field>
        <name>chambres</name>
        <rename/>
        <type>Integer</type>
        <format>########</format>
        <length>10</length>
        <precision>0</precision>
      </field>
      <field>
        <name>lits</name>
        <rename/>
        <type>Integer</type>
        <format>########</format>
        <length>10</length>
        <precision>0</precision>
      </field>
      <field>
        <name>categorie</name>
        <rename/>
        <type>String</type>
        <format>-</format>
        <length>50</length>
        <precision>-1</precision>
      </field>
    </fields>
  </step>
  <step>
    <name>Lookup_temps</name>
    <type>DatabaseLookup</type>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
    </partitioning>
    <cluster_schema/>
    <remotesteps/>
    <attributes/>
    <GUI>
      <xloc>1100</xloc>
      <yloc>100</yloc>
      <draw>Y</draw>
    </GUI>
    <connection>morocco_tourism</connection>
    <cached>N</cached>
    <cachesize>0</cachesize>
    <loadall>N</loadall>
    <fail_on_multiple>N</fail_on_multiple>
    <orderby/>
    <table>dim_temps</table>
    <keys>
      <key>
        <condition>=</condition>
        <name>annee</name>
        <field>annee</field>
      </key>
    </keys>
    <values>
      <value>
        <name>temps_id</name>
        <rename>temps_id</rename>
        <default/>
      </value>
    </values>
  </step>
  <step>
    <name>Lookup_categorie</name>
    <type>DatabaseLookup</type>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
    </partitioning>
    <cluster_schema/>
    <remotesteps/>
    <attributes/>
    <GUI>
      <xloc>1300</xloc>
      <yloc>100</yloc>
      <draw>Y</draw>
    </GUI>
    <connection>morocco_tourism</connection>
    <cached>N</cached>
    <cachesize>0</cachesize>
    <loadall>N</loadall>
    <fail_on_multiple>N</fail_on_multiple>
    <orderby/>
    <table>dim_categories_hotel</table>
    <keys>
      <key>
        <condition>=</condition>
        <name>nom_categorie</name>
        <field>categorie</field>
      </key>
    </keys>
    <values>
      <value>
        <name>categories_hotel_id</name>
        <rename>categories_hotel_id</rename>
        <default/>
      </value>
    </values>
  </step>
  <step>
    <name>Check_categorie_exists</name>
    <type>FilterRows</type>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
    </partitioning>
    <cluster_schema/>
    <remotesteps/>
    <attributes/>
    <GUI>
      <xloc>1500</xloc>
      <yloc>100</yloc>
      <draw>Y</draw>
    </GUI>
    <send_true_to>Inserer_fact_capacite</send_true_to>
    <send_false_to>Inserer_dim_categories</send_false_to>
    <condition>
      <negate>N</negate>
      <leftvalue>categories_hotel_id</leftvalue>
      <function>IS NOT NULL</function>
      <rightvalue/>
      <value/>
    </condition>
  </step>
  <step>
    <name>Inserer_fact_capacite</name>
    <type>InsertUpdate</type>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
    </partitioning>
    <cluster_schema/>
    <remotesteps/>
    <attributes/>
    <GUI>
      <xloc>1700</xloc>
      <yloc>100</yloc>
      <draw>Y</draw>
    </GUI>
    <connection>morocco_tourism</connection>
    <table>fact_capacite_hoteliere</table>
    <commit>1000</commit>
    <errorhandling>N</errorhandling>
    <use_batch>Y</use_batch>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <key>
        <name>temps_id</name>
        <field>temps_id</field>
        <condition>=</condition>
      </key>
      <key>
        <name>categories_hotel_id</name>
        <field>categories_hotel_id</field>
        <condition>=</condition>
      </key>
    </lookup>
    <update>
      <update>
        <name>nombre_units</name>
        <field>units</field>
        <update>Y</update>
      </update>
      <update>
        <name>nombre_chambres</name>
        <field>chambres</field>
        <update>Y</update>
      </update>
      <update>
        <name>nombre_lits</name>
        <field>lits</field>
        <update>Y</update>
      </update>
    </update>
  </step>
  <step>
    <name>Inserer_dim_categories</name>
    <type>InsertUpdate</type>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
    </partitioning>
    <cluster_schema/>
    <remotesteps/>
    <attributes/>
    <GUI>
      <xloc>1900</xloc>
      <yloc>100</yloc>
      <draw>Y</draw>
    </GUI>
    <connection>morocco_tourism</connection>
    <table>dim_categories_hotel</table>
    <commit>1000</commit>
    <errorhandling>N</errorhandling>
    <use_batch>Y</use_batch>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <key>
        <name>nom_categorie</name>
        <field>categorie</field>
        <condition>=</condition>
      </key>
    </lookup>
    <update>
      <update>
        <name>nom_categorie</name>
        <field>categorie</field>
        <update>Y</update>
      </update>
    </update>
  </step>
  <step>
    <name>Lookup_categorie_after</name>
    <type>DatabaseLookup</type>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
    </partitioning>
    <cluster_schema/>
    <remotesteps/>
    <attributes/>
    <GUI>
      <xloc>2100</xloc>
      <yloc>100</yloc>
      <draw>Y</draw>
    </GUI>
    <connection>morocco_tourism</connection>
    <cached>N</cached>
    <cachesize>0</cachesize>
    <loadall>N</loadall>
    <fail_on_multiple>N</fail_on_multiple>
    <orderby/>
    <table>dim_categories_hotel</table>
    <keys>
      <key>
        <condition>=</condition>
        <name>nom_categorie</name>
        <field>categorie</field>
      </key>
    </keys>
    <values>
      <value>
        <name>categories_hotel_id</name>
        <rename>categories_hotel_id</rename>
        <default/>
      </value>
    </values>
  </step>
  <hop>
    <from>Lire_capacite_hoteliere</from>
    <to>Selection_2019</to>
    <enabled>Y</enabled>
  </hop>
  <hop>
    <from>Lire_capacite_hoteliere</from>
    <to>Selection_2021</to>
    <enabled>Y</enabled>
  </hop>
  <hop>
    <from>Lire_capacite_hoteliere</from>
    <to>Selection_2022</to>
    <enabled>Y</enabled>
  </hop>
  <hop>
    <from>Selection_2019</from>
    <to>Ajout_annee_2019</to>
    <enabled>Y</enabled>
  </hop>
  <hop>
    <from>Selection_2021</from>
    <to>Ajout_annee_2021</to>
    <enabled>Y</enabled>
  </hop>
  <hop>
    <from>Selection_2022</from>
    <to>Ajout_annee_2022</to>
    <enabled>Y</enabled>
  </hop>
  <hop>
    <from>Ajout_annee_2019</from>
    <to>Union_annees</to>
    <enabled>Y</enabled>
  </hop>
  <hop>
    <from>Ajout_annee_2021</from>
    <to>Union_annees</to>
    <enabled>Y</enabled>
  </hop>
  <hop>
    <from>Ajout_annee_2022</from>
    <to>Union_annees</to>
    <enabled>Y</enabled>
  </hop>
  <hop>
    <from>Union_annees</from>
    <to>Convertir_types</to>
    <enabled>Y</enabled>
  </hop>
  <hop>
    <from>Convertir_types</from>
    <to>Lookup_temps</to>
    <enabled>Y</enabled>
  </hop>
  <hop>
    <from>Lookup_temps</from>
    <to>Lookup_categorie</to>
    <enabled>Y</enabled>
  </hop>
  <hop>
    <from>Lookup_categorie</from>
    <to>Check_categorie_exists</to>
    <enabled>Y</enabled>
  </hop>
  <hop>
    <from>Check_categorie_exists</from>
    <to>Inserer_fact_capacite</to>
    <enabled>Y</enabled>
  </hop>
  <hop>
    <from>Check_categorie_exists</from>
    <to>Inserer_dim_categories</to>
    <enabled>Y</enabled>
  </hop>
  <hop>
    <from>Inserer_dim_categories</from>
    <to>Lookup_categorie_after</to>
    <enabled>Y</enabled>
  </hop>
  <hop>
    <from>Lookup_categorie_after</from>
    <to>Inserer_fact_capacite</to>
    <enabled>Y</enabled>
  </hop>
</transformation>
